{% extends 'sknf/base.html' %}
{% block body_block %}

<!-- Main content -->
<section class="content-header" style="padding-top:60px">
    <h1>
        SK Members
    </h1>
</section>
<section class="content">

    <div class="box">
        <form method="GET" action="." class="search-form-skmember">
            <div class="box-header">
                <div class="shop-search main-box card-block" style="border: 1px solid rgb(204, 204, 204); margin-bottom: 10px; border-radius: 5px; padding-bottom: 0px;">
                    <div class="row">
                        <div class="form-group col-sm-5">
                            <strong>Name</strong>
                            {% if name is not None %}
                            <input class="form-control" value="{{name}}" type="search" name="name_contains" />
                            {% else %}
                            <input class="form-control" type="search" name="name_contains"/>
                            {% endif %}

                        </div>
                        <div class="form-group col-sm-5">
                            <strong>School</strong>
                            {% if school is not None %}
                            <input class="form-control " type="search" value="{{school}}" name="school_contains" />
                            {% else %}
                            <input class="form-control " type="search" name="school_contains"/>
                            {% endif%}
                        </div>
                    </div>
                    <div class="form-group pull-right">
                        <button type="submit" class="btn btn-primary search-skmember">Search</button>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <!-- Main content -->

            <div class="box-header">
                <span id = "alert_placeholder">
                    {% if messages %}
                    <div id="alertdiv" style="font-size:20px;margin-top:15px;" class="alert alert-success-customized">
                        <span>
                            {% for message in messages %}
                            {{ message }}
                            {% endfor %}
                        </span>
                    </div>
                    {% endif %}
                </span>

                <a type="button"
                   class="btn btn-primary pull-right"
                   href="{% url 'skmembers:skmember_add' %}">
                    <span class="fa fa-plus"></span>
                    New SK Member
                </a>
                <button type="submit" style="margin-right: 5px;" class="btn btn-primary export-skmember pull-right">Export CSV</button>
            </div>
            <!-- /.box-header -->
            <div class="box-body table-responsive">
                <table   id="example1" class=" skmember-search-table table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th class="col-sm-3">Name</th>
                        <th class="col-sm-2">Email</th>
                        <th class="col-sm-2">Mobile</th>
                        <th class="col-sm-3">School</th>
                        <th class="col-sm-1">Class</th>
                        <th class="col-sm-1">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for skmember in queryset %}
                    <tr>
                        <td>{{skmember.user.first_name}}</td>
                        <td>{{ skmember.user.email }}</td>
                        <td>{{ skmember.mobile }}</td>
                        <td>{{ skmember.school }}</td>
                        <td>{{ skmember.student_class }}</td>
                        <td align="center">
                            <a type="button" style="margin-right:10px"
                               class=""
                               href="{% url 'skmembers:skmember_detail' skmember.pk %}">
                                <span class="fa fa-eye"></span>
                            </a>
                            <a type="button"
                               class=""
                               href="{% url 'skmembers:skmember_update' skmember.pk %}">
                                <span class="fa fa-edit"></span>

                            </a>
                        </td>
                    </tr>
                    {% endfor %}

                    </tbody>
                    <tfoot>

                    </tfoot>
                </table>
                <p class="table-information">Showing {{ queryset.start_index }} to {{ queryset.end_index }} of {{ queryset.paginator.count }} entries</p>
                <ul class="pagination" style="float: right">

                    {% if queryset.has_previous %}
                    <li><a class="paginator" href="?page={{ queryset.previous_page_number }}"><i class="fa fa-chevron-left" aria-hidden="true"></i></a></li>
                    {% else %}
                    <li class="disabled"><span><i class="fa fa-chevron-left" aria-hidden="true"></i></span></li>
                    {% endif %}

                    {% if queryset.number|add:'-4' > 1 %}
                    <li><a class="paginator" href="?page={{ queryset.number|add:'-5' }}">&hellip;</a></li>
                    {% endif %}

                    {% for i in queryset.paginator.page_range %}
                    {% if queryset.number == i %}
                    <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
                    {% elif i > queryset.number|add:'-5' and i < queryset.number|add:'5' %}
                    <li><a class="paginator" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                    {% endfor %}

                    {% if queryset.paginator.num_pages > queryset.number|add:'4' %}
                    <li><a href="?page={{ queryset.number|add:'5' }}">&hellip;</a></li>
                    {% endif %}

                    {% if queryset.has_next %}
                    <li><a class="paginator" href="?page={{ queryset.next_page_number }}"><i class="fa fa-chevron-right" aria-hidden="true"></i></a></li>
                    {% else %}
                    <li class="disabled"><span><i class="fa fa-chevron-right" aria-hidden="true"></i></span></li>
                    {% endif %}

                </ul>
            </div>
        </form>
    </div>
    <!-- /.content -->
</section>
{% endblock %}
{% block extra_js %}
<script>
    $(function () {
        var name, school;
        $('.skmember-search-table').dataTable({
            'lengthChange': false,
            'searching': false,
            'info': false,
            'paging': false,
            'ordering'    : false,
        });

        $('.search-skmember').on('click', function (event) {
            event.preventDefault();
            $(".skmember-search-table").DataTable().destroy();
            name_contains = $("input[name='name_contains']").val();
            school_contains = $("input[name='school_contains']").val();
            name = name_contains, school = school_contains;
            $.ajax({
                type: 'GET',
                url: '/skmembers/search_skmember_list/',
                data: {
                    'name_contains': name_contains,
                    'school_contains': school_contains,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (data) {
                    if (data.form_is_valid) {

                        $(".box-body").html(data.html_list);  // <-- Replace the table body
                    }
                    $(".skmember-search-table").dataTable({
                        'lengthChange': false,
                        'searching': false,
                        'info': false,
                        'paging': false,
                        'ordering'    : false,
                    });
                }
            });
        });
        // auto suggesion
        autoSuggesion('/load_previous_users/', "input[name='name_contains']");
        autoSuggesion('/load_previous_schools/', "input[name='school_contains']");
        // auto suggesion
        pagination(".box-body", '/skmembers/search_skmember_list/', name, school, '.box-body .skmember-search-table');
    });
    //for skmember search export
    $(".export-skmember").click(function() {
        $('.search-form-skmember').prop('action', '/skmembers/skmember_list/export')
    });

    // $(".search-skmember").click(function() {
    //     $('.search-form-skmember').prop('action', '/skmembers/skmember_list');
    // });
    //for skleader search export
</script>
{% endblock %}

